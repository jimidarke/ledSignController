# =============================================================================
# BetaBrite LED Sign - Minimal Example
# =============================================================================
#
# QUICK START:
#   1. Copy this file to your ESPHome config folder
#   2. Create secrets.yaml with your wifi_ssid and wifi_password
#   3. Compile and upload
#   4. In Home Assistant, find "LED Sign Message" text entity - type to display!
#
# WIRING:
#   ESP32 GPIO17 (TX) --> RS232 Adapter TX --> BetaBrite RX
#   ESP32 GPIO16 (RX) --> RS232 Adapter RX --> BetaBrite TX
#   Use MAX3232 or similar level shifter (BetaBrite uses Â±12V RS232!)
#
# =============================================================================

substitutions:
  name: "led-sign"
  friendly_name: "LED Sign"

esphome:
  name: ${name}
  friendly_name: ${friendly_name}

esp32:
  board: esp32dev

logger:

api:
  encryption:
    key: !secret api_encryption_key

ota:
  - platform: esphome
    password: !secret ota_password

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "${name}-fallback"

captive_portal:

# -----------------------------------------------------------------------------
# BetaBrite Component
# -----------------------------------------------------------------------------

external_components:
  - source:
      type: git
      url: https://github.com/jimidarke/ledSignController
      ref: main
      path: esphome-betabrite/components
    components: [betabrite]

uart:
  id: sign_uart
  tx_pin: GPIO17
  rx_pin: GPIO16
  baud_rate: 9600
  data_bits: 7
  parity: EVEN
  stop_bits: 1

betabrite:
  id: led_sign
  uart_id: sign_uart

# -----------------------------------------------------------------------------
# Home Assistant Controls
# -----------------------------------------------------------------------------

# TEXT INPUT - Type a message in HA, it displays on the sign!
text:
  - platform: template
    name: "Message"
    icon: "mdi:message-text"
    optimistic: true
    min_length: 0
    max_length: 125
    mode: text
    on_value:
      - if:
          condition:
            lambda: 'return x.length() > 0;'
          then:
            - betabrite.display:
                id: led_sign
                text: !lambda 'return x;'
                color: !lambda 'return id(color_select).state;'
                mode: !lambda 'return id(mode_select).state;'

# COLOR PICKER
select:
  - platform: template
    name: "Color"
    id: color_select
    icon: "mdi:palette"
    optimistic: true
    options: ["green", "red", "amber", "orange", "yellow", "rainbow1"]
    initial_option: "green"

  # MODE PICKER
  - platform: template
    name: "Mode"
    id: mode_select
    icon: "mdi:animation"
    optimistic: true
    options: ["rotate", "hold", "scroll", "flash"]
    initial_option: "rotate"

# CLEAR BUTTON
button:
  - platform: template
    name: "Clear"
    icon: "mdi:eraser"
    on_press:
      - betabrite.clear:
          id: led_sign
